# Telegram 多功能签到机器人

这是一个基于 `python-telegram-bot` 构建的多功能签到机器人，旨在集成并自动化多个网站的每日签到任务。项目目前已集成 `Acck` 和 `Akile` 两个平台的签到功能，并包含了一套完整的管理员与多用户权限管理系统。

## ✨ 项目特色

-   **多平台集成**: 目前支持 `Acck` 和 `Akile` 平台的自动签到。
-   **沉浸式对话**: 通过独立的命令（如 `/acck`, `/akile`）引导用户完成账号配置，体验流畅。
-   **权限管理**:
    -   严格区分**管理员**和**普通用户**。
    -   管理员拥有所有权限，包括授权、禁用、统计、广播等。
    -   普通用户需要管理员通过 `/allow <用户ID>` 授权后才能使用。
-   **数据持久化**:
    -   用户凭证（账号、密码、TOTP）在首次配置后将加密保存在服务器，后续可实现"一键签到"。
    -   所有用户数据按模块和用户ID隔离存储，确保安全。
-   **安全与控制**:
    -   **黑名单系统**: 管理员可通过 `/ban` 命令封禁恶意用户。
    -   **每日次数限制**: 可为普通用户设置每日签到次数上限，防止滥用。
    -   **防滥用机制**: 普通用户尝试执行管理员命令达到一定次数后会自动被拉黑。
-   **强大的管理员功能**:
    -   **/allow, /disallow**: 管理用户白名单。
    -   **/ban, /unban**: 管理用户黑名单。
    -   **/stats, /top**: 查看详细的使用统计和活跃用户排行。
    -   **/broadcast**: 向所有授权用户广播消息。
    -   **/export**: 导出所有用户数据和统计信息。
    -   **/setlimit**: 动态设置普通用户的每日使用上限。
    -   **/restart, /shutdown**: 通过指令远程控制Bot的运行状态。
-   **详细日志**:
    -   管理员的所有操作都会被记录在每日日志中 (`admin_log_YYYY-MM-DD_HHMM.json`)。
    -   管理员可通过 `/summary` 命令快速查看所有日志文件的概览。

## 🚀 快速开始

### 1. 环境准备

-   Python 3.8+
-   `pip` 包管理器

### 2. 克隆项目

```bash
git clone [你的GitHub项目URL]
cd [你的项目目录]
```

### 3. 安装依赖

项目依赖 `python-telegram-bot` 和 `requests`。

```bash
pip install python-telegram-bot --upgrade
pip install requests
```

### 4. 项目配置

打开 `bot.py` 文件，在文件顶部的配置区填入你的信息：

```python
# ========== 重要配置 ==========
# 请在下方填写你的 Telegram Bot Token 和 Chat ID
TELEGRAM_BOT_TOKEN = "在这里填写你的Bot Token"
TELEGRAM_CHAT_ID = "在这里填写你的Chat ID"  # 这是管理员的Telegram用户ID
# ==============================
```

-   `TELEGRAM_BOT_TOKEN`: 从 BotFather 获取你的机器人 Token。
-   `TELEGRAM_CHAT_ID`: 你的个人 Telegram 用户ID。这将是此机器人的唯一管理员。

### 5. 运行机器人

配置完成后，在项目根目录下运行：

```bash
python bot.py
```

看到 "🚀 Bot已启动..." 字样，说明机器人已成功运行。

## 📝 命令列表

### 用户命令

-   `/start`: 开始与机器人交互，并获取你的用户ID。
-   `/help`: 显示帮助信息和所有可用命令。
-   `/acck`: 开始 `Acck` 平台的签到流程。
-   `/akile`: 开始 `Akile` 平台的签到流程。
-   `/me`: 查询你的个人状态（身份、使用次数、累计签到等）。
-   `/unbind`: 清除你在服务器上保存的所有账号信息。
-   `/cancel`: 在任何对话流程中，取消当前操作。

### 👑 管理员专用命令

-   `/allow <用户ID>`: 授权一个用户使用此机器人。
-   `/disallow <用户ID>`: 移除一个用户的授权。
-   `/ban <用户ID>`: 将一个用户加入黑名单，禁止其使用。
-   `/unban <用户ID>`: 将一个用户从黑名单中移除。
-   `/stats`: 查看所有用户的使用统计。
-   `/top`: 查看最活跃的用户排行榜。
-   `/broadcast <消息内容>`: 向所有已授权用户发送广播消息。
-   `/export`: 将所有用户凭证和统计数据导出为JSON文件。
-   `/setlimit <次数>`: 设置每个普通用户每日的签到次数上限。
-   `/summary`: 汇总并显示所有管理员操作日志。
-   `/menu`: 自动为机器人设置命令列表菜单。
-   `/restart`: **重启**机器人进程。
-   `/shutdown`: **关闭**机器人进程。

## 📁 目录结构

```
.
├── Acck/
│   ├── qiandao.py
│   └── users/      # 存储Acck平台的用户凭证
├── Akile/
│   ├── qiandao.py
│   └── users/      # 存储Akile平台的用户凭证
└── bot.py          # 机器人主逻辑文件
```

## 🤝 贡献

欢迎通过 Pull Request 或 Issues 为此项目做出贡献。如果你有想要集成的新签到模块，也欢迎提出！

## 📄 开源许可

本项目采用 [MIT License](LICENSE) 开源。 